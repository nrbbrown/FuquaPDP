<script>
Goals.uid = <%= @uid %>;
Goals.filter = '<%= @filter %>';
Goals.complete = '<%= @complete %>';
Goals.goallist = <%= raw @fullgoals.to_json(:include=>[:tasks]) %>;
dojo.query('meta').forEach(function(m){
    if(m.name == 'csrf-token'){
        Goals.token = m.content;
    }
});
dojo.ready(Goals.init);
dojo.ready(Score.init);
</script>



<div id="listcontainer">


<div id="activecontainer">
<div id="activecomplete0"><%= link_to 'active', :controller=>'goals', :action=>'index', :filter=>@filter, :u=>@uid %></div> 
<div id="activecomplete1"><%= link_to 'complete', :controller=>'goals', :action=>'index', :complete=>1, :filter=>@filter, :u=>@uid %></div>
</div>

<div class="categorylistcontainer">
<div id="categorylist">
<div id="cat-academic">academic</div>
<div id="cat-career">career</div>
<div id="cat-social">social</div>
<div id="cat-personal">personal</div>
<div id="cat-physical">physical</div>
</div>
</div>

<% @goals.each do |goal| %>
<div class="goalitem goalcat<%= goal.category %>" style="display:none">
<div class="goalcontent">
	<div class="progressBoard" id="progressBoard_<%=goal.id%>" style="display:none;">
		<div class="closeBtn" onclick="javascript:closeProgressBox(<%=goal.id%>)"><img src="/images/BlueClose_off.png"></div>
		<div id="progress_ajax_<%=goal.id%>"></div>
	</div>
<%if @isme %>
    <div class="editdeletecontainer">
	<a href="javascript:getGoalTaskProgress(<%=goal.id%>)">progress</a>
    <%if @complete != '1' %>
        <%= link_to 'edit', edit_goal_path(goal) %>
    <% end %>
    <%= link_to 'delete', goal, confirm: 'Are you sure you want to delete this goal?', method: :delete %>
    </div>
<% end %>

<div class="goaldesc"><%= goal.goal == '' ? 'my '+@filter+' goal' : goal.goal %></div>
<div class="goalvalues"><span class="goalsubtitle">values</span> <%= goal.values == '' ? 'N/A' : goal.values %></div>

<div class="displaytaskarea">
<table>
    <% cc = 0 %>
    <% for s in (0..9) %>
    <% if goal.tasks[s] %>
    <% if goal.tasks[s].is_complete == 1 then cc = cc+1 end %>
    <tr>
        <td class="tasktdA"><span class="tasksubtitle">task</span></td>
        <td class="tasktdB">
            <%= goal.tasks[s].task %>
        </td>
        <td class="tasktdC"><img src="/images/goal_clock.png"/></td>
        <td class="tasktdD">
            <%if goal.tasks[s].startdue %>
                <%= goal.tasks[s].startdue.strftime("%m.%d.%Y") %> 
                -
            <% end %>
            <%= goal.tasks[s].due.strftime("%m.%d.%Y") %>
		</td>
        <td class="tasktdE">
			<div title="goal<%= goal.id %>" id="taskid<%= goal.tasks[s].id%>" 
            class="<%=@isme%>taskcheck<%= goal.tasks[s].is_complete %>"></div>
        </td>
    </tr>
    <% end %>
    <% end %>
    <% if  goal.tasks.length == 0 %>
    <tr>
        <td><span class="tasksubtitle">define tasks to track your goal's progress</span></td>
    </tr>
    <% end %>
</table>
</div>

<div class="goalaccountability">
    <span class="goalsubtitle">accountability</span>  
    <% found = 0; @users.each do |user| %>
        <% if user.name == goal.accountability %>
            <%= link_to(user.name, goals_path(:u => user.id)) %>
            <% found = 1 %>
        <% end %>
    <% end %>
    <% if found == 0 %>
         <%= goal.accountability == '' ? 'N/A' : goal.accountability %>
    <% end %>
</div>

<div class="goalscore" id="goalscore<%=goal.id%>"><%= ((cc*100.0)/[goal.tasks.length*1.0,1].max).round %>%</div>

</div>
</div>
<% end %>
<% if @goals.length == 0 %>
<div class="goalitem">
<div class="goalcontent">
<div class="goaldesc">no 
<% if @complete == '1' %>
complete
<% else %>
active
<% end %>
goals</div>
</div>
</div>
<% end %>

</div>

<div class="goallistingbottompadding"></div>


<div id="scoreitem">
    <div class="infoscorecontainer">
        <div id="bottomscorecontent">
            <div class="bottomscoretitle">
                goal scorecard
            </div>
            <div>
                <table>
                    <tr><td class="scoredesc"><%= @filter %> completeness</td><td class="scorenum" id="categoryScore"></td></tr>
                    <tr><td class="scoredesc">overall completeness</td><td class="scorenum" id="overallScore"></td></tr>
                </table>
            </div>
        </div>
        <div id="infoscore" class="iteminactive">score</div>
        <div id="scoreplusminus" class="hidediv"></div>
    </div>
</div>

